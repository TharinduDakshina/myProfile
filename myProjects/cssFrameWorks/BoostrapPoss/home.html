<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link href="assets/Bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="/assets/css/fonts/css/all.css" rel="stylesheet">
    <style>
        #image {
            width: 100vw;
            height: 92vh;
            filter: blur(0.3rem);
        }

        #customerSearch > div:first-child {
            background-color: lightgreen;
            width: 25vw;
            height: 5vh;
        }

        #customerSearch > div:first-child > h6 {
            font-weight: normal;

        }

        #customerSearch > div:nth-child(2) {
            width: 25vw;
            height: 20vh;
        }

        .buttonSet {
            width: 20vw;
        }

        #itemSearch > div:first-child {
            background-color: lightgreen;
            width: 25vw;
            height: 5vh;
        }

        #itemSearch > div:first-child > h6 {
            font-weight: normal;
        }

        #itemSearch > div:nth-child(2) {
            width: 25vw;
            height: 20vh;
        }


    </style>
</head>
<body>
<header>
    <nav class="navbar navbar-light navbar navbar-expand-lg" style="background-color: #dbf1e2;">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a aria-current="page" class="nav-link active" href="#image" id="homeButton">Home</a>
                    </li>
                    <li class="nav-item">
                        <a aria-current="page" class="nav-link active" href="#customer" id="customerButton">Customer</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a aria-current="page" class="nav-link active" href="#item" id="itemButton">Items</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a aria-current="page" class="nav-link active" href="#placeOrder" id="placeOrderButton">PlaceOrder</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
</header>

<main>

    <img alt="image loading Error" id="image" src="assets/images/poss.jpg">

    <!--Customer-->
    <div class="container " id="customer">
        <svg class="bi bi-person-square mb-2 mt-2 d-inline-block" fill="currentColor" height="5%" viewBox="0 0 16 16"
             width="5%" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12z"/>
            <h1 class="d-inline-block p-1">Customer</h1>
        </svg>
        <section class="row">
            <div class="col">
                <div class="container" id="customerSearch">
                    <div>
                        <h6 class="h3 p-1">Customer Search</h6>
                    </div>
                    <div class="bg-light">
                        <nav class="navbar navbar-light bg-light">
                            <div class="container-fluid">
                                <form class="d-flex p-3 border">
                                    <input aria-label="Search" class="form-control me-2" id="txtCustomerSearch"
                                           placeholder="Input NIC number"
                                           type="search">
                                    <button class="btn btn-outline-success" id="btnSearch" type="submit">Search</button>
                                </form>
                                <!-- Example single danger button -->
                                <div aria-label="Basic mixed styles example" class="btn-group p-1 buttonSet"
                                     role="group">
                                    <button class="btn btn-danger" id="deleteCustomer" type="button">Delete</button>
                                    <button class="btn btn-warning" id="btnUpdateCustomer" type="button">update</button>
                                    <button class="btn btn-success" id="saveCustomer" type="button">Save or Update
                                    </button>
                                </div>
                            </div>
                        </nav>
                    </div>


                </div>
            </div>

            <div class="col bg-white position-relative">
                <div class="mb-3">
                    <label class="form-label" for="cstId">Customer Id</label>
                    <input class="form-control" id="cstId" placeholder="Customer Id" type="text">
                    <p><small class="text-danger pl-1" id="errorId"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="cstName">Customer Name</label>
                    <input class="form-control" id="cstName" placeholder="Customer Name" type="text">
                    <p><small class="text-danger pl-1" id="errorName"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="cstAddress">Customer Address</label>
                    <input class="form-control" id="cstAddress" placeholder="Customer Address" type="text">
                    <p><small class="text-danger pl-1" id="errorAddress"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="cstTp">Customer Tp</label>
                    <input class="form-control" id="cstTp" placeholder="Customer Tp" type="text">
                    <p><small class="text-danger pl-1" id="errorTp"></small></p>
                </div>

            </div>

        </section>

        <section class="row">
            <table class="table table-success table-striped mt-5">
                <thead>
                <tr>
                    <th scope="col">Customer Id</th>
                    <th scope="col">Customer Name</th>
                    <th scope="col">Customer Address</th>
                    <th scope="col">Customer Tp</th>
                </tr>
                </thead>
                <tbody id="customerTableBody">

                </tbody>
            </table>
        </section>
    </div>

    <!--Items-->
    <div class="container" id="item">
        <svg class="bi bi-boxes" fill="currentColor" height="4%" viewBox="0 0 16 16" width="4%"
             xmlns="http://www.w3.org/2000/svg">
            <path d="M7.752.066a.5.5 0 0 1 .496 0l3.75 2.143a.5.5 0 0 1 .252.434v3.995l3.498 2A.5.5 0 0 1 16 9.07v4.286a.5.5 0 0 1-.252.434l-3.75 2.143a.5.5 0 0 1-.496 0l-3.502-2-3.502 2.001a.5.5 0 0 1-.496 0l-3.75-2.143A.5.5 0 0 1 0 13.357V9.071a.5.5 0 0 1 .252-.434L3.75 6.638V2.643a.5.5 0 0 1 .252-.434L7.752.066ZM4.25 7.504 1.508 9.071l2.742 1.567 2.742-1.567L4.25 7.504ZM7.5 9.933l-2.75 1.571v3.134l2.75-1.571V9.933Zm1 3.134 2.75 1.571v-3.134L8.5 9.933v3.134Zm.508-3.996 2.742 1.567 2.742-1.567-2.742-1.567-2.742 1.567Zm2.242-2.433V3.504L8.5 5.076V8.21l2.75-1.572ZM7.5 8.21V5.076L4.75 3.504v3.134L7.5 8.21ZM5.258 2.643 8 4.21l2.742-1.567L8 1.076 5.258 2.643ZM15 9.933l-2.75 1.571v3.134L15 13.067V9.933ZM3.75 14.638v-3.134L1 9.933v3.134l2.75 1.571Z"/>
        </svg>
        <h1 class="d-inline-block p-1">Items</h1>
        <section class="row">
            <div class="col">
                <div class="container" id="itemSearch">
                    <div>
                        <h6 class="h3 p-1">Item Search</h6>
                    </div>
                    <div class="bg-light">
                        <nav class="navbar navbar-light bg-light">
                            <div class="container-fluid">
                                <form class="d-flex p-3 border">
                                    <input aria-label="Search" class="form-control me-2" id="txtItemSearch"
                                           placeholder="Input Item code"
                                           type="search">
                                    <button class="btn btn-outline-success" id="btnItemSearch" type="submit">Search
                                    </button>
                                </form>

                                <div aria-label="Basic mixed styles example" class="btn-group p-1 buttonSet"
                                     role="group">
                                    <button class="btn btn-danger" id="deleteItem" type="button">Delete</button>
                                    <button class="btn btn-warning" id="btnUpdate" type="button">Update</button>
                                    <button class="btn btn-success" id="saveItem" type="button">Save or Update</button>
                                </div>
                            </div>
                        </nav>
                    </div>

                </div>
            </div>

            <div class="col bg-white position-relative">
                <div class="mb-3">
                    <label class="form-label" for="itemId">Item Id</label>
                    <input class="form-control" id="itemId" placeholder="Item Id" type="text">
                    <p><small class="text-danger pl-1" id="errorItemId"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="itemName">Item Name</label>
                    <input class="form-control" id="itemName" placeholder="Item Name" type="text">
                    <p><small class="text-danger pl-1" id="errorItemName"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="itemQty">Item Qty</label>
                    <input class="form-control" id="itemQty" placeholder="Item Qty" type="text">
                    <p><small class="text-danger pl-1" id="errorQty"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="itemPrice">Item Price</label>
                    <input class="form-control" id="itemPrice" placeholder="Item Price" type="text">
                    <p><small class="text-danger pl-1" id="errorPrice"></small></p>
                </div>

            </div>
        </section>

        <section class="row">
            <table class="table table-success table-striped mt-5">
                <thead>
                <tr>
                    <th scope="col">Item Code</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Item QTY</th>
                    <th scope="col">Item Price</th>
                </tr>
                </thead>
                <tbody id="itemTableBody">

                </tbody>
            </table>
        </section>
    </div>

    <!--Place Order-->
    <div class="container " id="placeOrder">
        <section class="row m-2 rounded-3">
            <div class="col bg-light m-1 card" style="width: 18rem;">
                <div class="card-body">
                    <form class="row g-2">
                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Order Id</label>
                            <input class="form-control" id="validationDefault01" required type="text" value="Mark">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault02">Date</label>
                            <input class="form-control" id="validationDefault02" required type="text" value="Otto">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Qty</label>
                            <input class="form-control" required type="text" value="Mark">
                        </div>


                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Customer Id</label>
                            <input class="form-control" required type="text" value="Mark">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="validationDefault03">Customer Name</label>
                            <input class="form-control" id="validationDefault03" required type="text">
                        </div>

                        <div class="col-md-3">
                            <label class="form-label" for="validationDefault04">State</label>
                            <select class="form-select" id="validationDefault04" required>
                                <option disabled selected value="">Choose...</option>
                                <option>...</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label" for="validationDefault05">Zip</label>
                            <input class="form-control" id="validationDefault05" required type="text">
                        </div>
                    </form>
                </div>
            </div>
            <div class="col bg-light m-1 card" style="width: 18rem;">
                <div class="card-body">
                    <form class="row g-2">
                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Order Id</label>
                            <input class="form-control" required type="text" value="Mark">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault02">Date</label>
                            <input class="form-control" required type="text" value="Otto">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Qty</label>
                            <input class="form-control" required type="text" value="Mark">
                        </div>


                        <div class="col-md-4">
                            <label class="form-label" for="validationDefault01">Customer Id</label>
                            <input class="form-control" required type="text" value="Mark">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="validationDefault03">Customer Name</label>
                            <input class="form-control" required type="text">
                        </div>

                        <div class="col-md-3">
                            <label class="form-label" for="validationDefault04">State</label>
                            <select class="form-select" required>
                                <option disabled selected value="">Choose...</option>
                                <option>...</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label" for="validationDefault05">Zip</label>
                            <input class="form-control" required type="text">
                        </div>
                    </form>
                </div>
            </div>
            <div class="col bg-warning m-1 card" style="width: 18rem;">
                <h4 class="display-5 fw-bold ">Total : 12500.00/=</h4>
                <h4 class="display-6 fw-bold ">subTotal : 12200.00/=</h4>
                <form class="row g-2 m-1">
                    <div class="col-md-4">
                        <label class="form-label" for="validationDefault01">Cash</label>
                        <input class="form-control" required type="text" value="00.00">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="validationDefault02">Discount</label>
                        <input class="form-control" required type="text" value="0.00">
                    </div>

                    <div class="col-md-4">
                        <label class="form-label" for="validationDefault01">Balance</label>
                        <input class="form-control" required type="text" value="00.00">
                    </div>

                    <div class="position-relative">
                        <button class="btn btn-success position-absolute top-100 end-0" type="button">Pay bill</button>
                    </div>
                </form>
            </div>
        </section>

        <section class="row m-2">
            <table class="table table-success table-striped mt-5">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                </tr>
                <tr>
                    <th scope="row">3</th>
                    <td>Park</td>
                    <td>Siman</td>
                    <td>@mdo</td>
                </tr>

                <tr>
                    <th scope="row">4</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                </tr>

                <tr>
                    <th scope="row">5</th>
                    <td>Saman</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                </tr>

                <tr>
                    <th scope="row">6</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                </tr>
                </tbody>
            </table>
        </section>
    </div>

</main>


<script src="assets/Bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/jQuery/jquery-3.6.0.min.js"></script>
<script src="db/DB.js"></script>
<script>

    $("#image").css("display", "block");
    $("#customer").css("display", "none");
    $("#item").css("display", "none");
    $("#placeOrder").css("display", "none");

    $("#homeButton").click(function () {
        $("#image").css("display", "block");
        $("#customer").css("display", "none");
        $("#item").css("display", "none");
        $("#placeOrder").css("display", "none");
    });

    $("#customerButton").click(function () {
        $("#image").css("display", "none");
        $("#customer").css("display", "block");
        $("#item").css("display", "none");
        $("#placeOrder").css("display", "none");
    });

    $("#itemButton").click(function () {
        $("#image").css("display", "none");
        $("#customer").css("display", "none");
        $("#item").css("display", "block");
        $("#placeOrder").css("display", "none");
    });

    $("#placeOrderButton").click(function () {
        $("#image").css("display", "none");
        $("#customer").css("display", "none");
        $("#item").css("display", "none");
        $("#placeOrder").css("display", "block");
    });
</script>

<script>

    $("#saveCustomer").prop("disabled", true);

    $("#saveCustomer").click(function () {
        saveCustomer();
        clearAll();
        loadAllCustomers();
    });

    function saveCustomer() {
        //gather customer information
        let customerID = $("#cstId").val();
        let customerName = $("#cstName").val();
        let customerAddress = $("#cstAddress").val();
        let customerTp = $("#cstTp").val();

        //create Object
        var customerObject = {
            id: customerID,
            name: customerName,
            address: customerAddress,
            tp: customerTp
        };
        //
        customerDB.push(customerObject);

    }

    function checkAlreadyExits() {
        for (let i = 0; i < customerDB.length; i++) {
            if ($("#cstId").val() == customerDB[i].id) {
                return -1;
            }
        }
        return 0;
    }

    function loadAllCustomers() {
        $("#customerTableBody").empty();
        for (var i of customerDB) {
            /*create a html row*/
            let row = `<tr><td>${i.id}</td><td>${i.name}</td><td>${i.address}</td><td>${i.tp}</td></tr>`;
            /*select the table body and append the row */
            $("#customerTableBody").append(row);
        }
        $("#customerTableBody>tr").click(function () {
            let cstId = $(this).children(":eq(0)").text();
            let cstName = $(this).children(":eq(1)").text();
            let cstAddress = $(this).children(":eq(2)").text();
            let cstTp = $(this).children(":eq(3)").text();

            console.log(cstId, cstName, cstAddress, cstTp);

            $("#cstId").val(cstId);
            $("#cstName").val(cstName);
            $("#cstAddress").val(cstAddress);
            $("#cstTp").val(cstTp);
        });
    }

    function clearAll() {
        $('#cstId,#cstName,#cstAddress,#cstTp').val("");
        $('#cstId,#cstName,#cstAddress,#cstTp').css('border', '2px solid #ced4da');
        $('#cstId').focus();
        $("#saveCustomer").attr('disabled', true);
        $("#deleteCustomer").attr('disabled', true);
        loadAllCustomers();
        $("#errorId,#errorName,#errorAddress,#errorTp").text("");
    }

    let regxCstId = /^(C00-)[0-9]{3,4}$/;
    let regxCstName = /^[A-z ]{3,20}$/;
    let regxCstAddress = /^[A-z 0-9/,]{3,50}$/;
    let regxTp = /^[0-9]{10}$/;

    $('#cstId,#cstName,#cstAddress,#cstTp').on('keydown', function (eventOb) {
        if (eventOb.key == "Tab") {
            eventOb.preventDefault();
        }
    });

    $('#cstId,#cstName,#cstAddress,#cstTp').on('blur', function () {
        formValid();
    });

    function formValid() {
        var cusID = $("#cstId").val();
        let result = checkAlreadyExits();
        if (result == -1) {
            console.log(result)
            $("#cstId").css('border', '2px solid red');
            $("#errorId").text("This id was already exits.");
            return false;
        }
        $("#cstId").css('border', '2px solid green');
        $("#errorId").text("");
        if (regxCstId.test(cusID)) {
            var cusName = $("#cstName").val();
            if (regxCstName.test(cusName)) {
                $("#cstName").css('border', '2px solid green');
                $("#errorName").text("");
                var cusAddress = $("#cstAddress").val();
                if (regxCstAddress.test(cusAddress)) {
                    var cusTp = $("#cstTp").val();
                    var resp = regxTp.test(cusTp);
                    $("#cstAddress").css('border', '2px solid green');
                    $("#errorAddress").text("");
                    if (resp) {
                        $("#cstTp").css('border', '2px solid green');
                        $("#errorTp").text("");
                        return true;
                    } else {
                        $("#cstTp").css('border', '2px solid red');
                        $("#errorTp").text("Cus Salary is a required field : Pattern 100.00 or 100");
                        return false;
                    }
                } else {
                    $("#cstAddress").css('border', '2px solid red');
                    $("#errorAddress").text("Cus Address is a required field : Mimum 7");
                    return false;
                }
            } else {
                $("#cstName").css('border', '2px solid red');
                $("#errorName").text("Cus Name is a required field : Mimimum 5, Max 20, Spaces Allowed");
                return false;
            }
        } else {
            $("#cstId").css('border', '2px solid red');
            $("#errorId").text("Cus ID is a required field : Pattern C00-000");
            return false;
        }
    }

    $("#cstId").on('keyup', function (eventOb) {
        setButton();
        if (eventOb.key == "Enter") {
            checkIfValid();
        }
    });

    $("#cstName").on('keyup', function (eventOb) {
        setButton();
        if (eventOb.key == "Enter") {
            checkIfValid();
        }
    });

    $("#cstAddress").on('keyup', function (eventOb) {
        setButton();
        if (eventOb.key == "Enter") {
            checkIfValid();
        }
    });

    $("#cstTp").on('keyup', function (eventOb) {
        setButton();
        if (eventOb.key == "Enter") {
            checkIfValid();
        }
    });

    function checkIfValid() {
        var cusID = $("#cstId").val();
        if (regxCstId.test(cusID)) {
            $("#cstName").focus();
            var cusName = $("#cstName").val();
            if (regxCstName.test(cusName)) {
                $("#cstAddress").focus();
                var cusAddress = $("#cstAddress").val();
                if (regxCstAddress.test(cusAddress)) {
                    $("#cstTp").focus();
                    var cstTp = $("#cstTp").val();
                    var resp = regxTp.test(cstTp);
                    if (resp) {
                        let res = confirm("Do you really need to add this Customer..?");
                        if (res) {
                            saveCustomer();
                            clearAll();
                        }
                    } else {
                        $("#cstTp").focus();
                    }
                } else {
                    $("#cstAddress").focus();
                }
            } else {
                $("#cstName").focus();
            }
        } else {
            $("#cstId").focus();
        }
    }

    function setButton() {
        let b = formValid();
        if (b) {
            $("#saveCustomer").attr('disabled', false);
        } else {
            $("#saveCustomer").attr('disabled', true);
        }
    }

    $('#saveCustomer').click(function () {
        checkIfValid();
    });


    $("#btnSearch").click(function () {
        var searchID = $("#txtCustomerSearch").val();

        var response = searchCustomer(searchID);
        if (response) {
            $("#cstId").val(response.id);
            $("#cstName").val(response.name);
            $("#cstAddress").val(response.address);
            $("#cstTp").val(response.tp);
        } else {
            clearAll();
            alert("No Such a Customer");
        }

    });

    function searchCustomer(id) {
        for (let i = 0; i < customerDB.length; i++) {
            if (customerDB[i].id == id) {
                return customerDB[i];
            }
        }
    }


    $("#deleteCustomer").click(function () {
        var deleteId = $("#cstId").val();
        deleteCustomer(deleteId);
        clearAll();
    });

    function deleteCustomer(id) {
        var index = -1;
        for (var i = 0; i < customerDB.length; i++) {
            if (customerDB[i].id == id) {
                index = i;
                alert(customerDB[i].id + " Deleted");
            }
        }

        customerDB.splice(index, 1);
    }

    $("#btnUpdateCustomer").click(function (){
        var updateId = $("#cstId").val();
        var updateName = $("#cstName").val();
        var updateAddress = $("#cstAddress").val();
        var updateTp = $("#cstTp").val();
        updateCustomer(updateId,updateName,updateAddress,updateTp);
        clearAll();
    });

    function updateCustomer(id,name,address,tp){
        for (let i=0 ; i<customerDB.length;i++){
            if (id==customerDB[i].id){
                customerDB[i].name=name;
                customerDB[i].address=address;
                customerDB[i].tp=tp;

                alert("Successfully Update ");
            }
        }
    }
</script>

<script>
    $("#saveItem").prop("disabled", true);

    $("#saveItem").click(function () {
        saveItem();
        clearItemAll();
        loadAllItem();
    });

    function saveItem() {
        //gather Item information
        let itemId = $("#itemId").val();
        let itemName = $("#itemName").val();
        let itemQTY = $("#itemQty").val();
        let itemPrice = $("#itemPrice").val();

        //create Object
        var itemObject = {
            iId: itemId,
            iName: itemName,
            iQty: itemQTY,
            iPrice: itemPrice
        };

        itemDB.push(itemObject);
    }

    function checkAlreadyExitsItem() {
        for (let i = 0; i < itemDB.length; i++) {
            if ($("#itemId").val() == itemDB[i].iId) {
                return -1;
            }
        }
        return 0;
    }

    function clearItemAll() {
        $('#itemId,#itemName,#itemQty,#itemPrice').val("");
        $('#itemId,#itemName,#itemQty,#itemPrice').css('border', '2px solid #ced4da');
        $('#itemId').focus();
        $("#saveItem").attr('disabled', true);
        loadAllItem();
        $("#errorItemId,#errorItemName,#errorQty,#errorPrice").text("");
    }

    function loadAllItem() {
        $("#itemTableBody").empty();
        for (var i of itemDB) {
            /*create a html row*/
            let itemRow = `<tr><td>${i.iId}</td><td>${i.iName}</td><td>${i.iQty}</td><td>${i.iPrice}</td></tr>`;
            /*select the table body and append the row */
            $("#itemTableBody").append(itemRow);
        }
        $("#itemTableBody>tr").click(function () {
            let id = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let QTY = $(this).children(":eq(2)").text();
            let iPrice = $(this).children(":eq(3)").text();

            $("#itemId").val(id);
            $("#itemName").val(name);
            $("#itemQty").val(QTY);
            $("#itemPrice").val(iPrice);
        });
    }

    let regxId = /^(I00-)[0-9]{3,4}$/;
    let regxItemName = /^[A-z ]{3,20}$/;
    let regxItemQty = /^[0-9]{1,3}$/;
    let regxItemPrice = /^[0-9](.){1,6}$/;

    $('#itemId,#itemName,#itemQty,#itemPrice').on('keydown', function (eventOb) {
        if (eventOb.key == "Tab") {
            eventOb.preventDefault();
        }
    });

    $('#itemId,#itemName,#itemQty,#itemPrice').on('blur', function () {
        formValidItem();
    });

    function formValidItem() {
        var itemId = $("#itemId").val();
        let result = checkAlreadyExitsItem();
        if (result == -1) {
            $("#itemId").css('border', '2px solid red');
            $("#errorItemId").text("This id was already exits.");
            return false;
        }
        $("#itemId").css('border', '2px solid green');
        $("#errorItemId").text("");
        if (regxId.test(itemId)) {
            var itemName = $("#itemName").val();
            if (regxItemName.test(itemName)) {
                $("#itemName").css('border', '2px solid green');
                $("#errorItemName").text("");
                var itemQty = $("#itemQty").val();
                if (regxItemQty.test(itemQty)) {
                    var itemPrice = $("#itemPrice").val();
                    var resp = regxItemPrice.test(itemPrice);
                    $("#itemQty").css('border', '2px solid green');
                    $("#errorQty").text("");
                    if (resp) {
                        $("#itemPrice").css('border', '2px solid green');
                        $("#errorPrice").text("");
                        return true;
                    } else {
                        $("#itemPrice").css('border', '2px solid red');
                        $("#errorPrice").text("Item Price is a required field : Pattern 100.00 or 100");
                        return false;
                    }
                } else {
                    $("#itemQty").css('border', '2px solid red');
                    $("#errorQty").text("Item Qty is a required field : Mimum 7");
                    return false;
                }
            } else {
                $("#itemName").css('border', '2px solid red');
                $("#errorItemName").text("Item Name is a required field : Mimimum 5, Max 20, Spaces Allowed");
                return false;
            }
        } else {
            $("#itemId").css('border', '2px solid red');
            $("#errorItemId").text("Item ID is a required field : Pattern C00-000");
            return false;
        }
    }

    $("#itemId").on('keyup', function (eventOb) {
        setItemButton();
        if (eventOb.key == "Enter") {
            checkIfValidItem();
        }
    });

    $("#itemName").on('keyup', function (eventOb) {
        setItemButton();
        if (eventOb.key == "Enter") {
            checkIfValidItem();
        }
    });

    $("#itemQty").on('keyup', function (eventOb) {
        setItemButton();
        if (eventOb.key == "Enter") {
            checkIfValidItem();
        }
    });

    $("#itemPrice").on('keyup', function (eventOb) {
        setItemButton();
        if (eventOb.key == "Enter") {
            checkIfValidItem();
        }
    });

    function checkIfValidItem() {
        var itemId = $("#itemId").val();
        if (regxId.test(itemId)) {
            $("#itemName").focus();
            var itemName = $("#itemName").val();
            if (regxItemName.test(itemName)) {
                $("#itemQty").focus();
                var itemQty = $("#itemQty").val();
                if (regxItemQty.test(itemQty)) {
                    $("#itemPrice").focus();
                    var itemPrice = $("#itemPrice").val();
                    var resp = regxItemPrice.test(itemPrice);
                    if (resp) {
                        let res = confirm("Do you really need to add this Item..?");
                        if (res) {
                            saveItem();
                            clearItemAll();
                        }
                    } else {
                        $("#itemPrice").focus();
                    }
                } else {
                    $("#itemQty").focus();
                }
            } else {
                $("#itemName").focus();
            }
        } else {
            $("#itemId").focus();
        }
    }

    function setItemButton() {
        let b = formValidItem();
        if (b) {
            $("#saveItem").attr('disabled', false);
        } else {
            $("#saveItem").attr('disabled', true);
        }
    }

    $("#btnItemSearch").click(function () {
        var searchID = $("#txtItemSearch").val();

        var response = searchItem(searchID);
        if (response) {
            $("#itemId").val(response.iId);
            $("#itemName").val(response.iName);
            $("#itemQty").val(response.iQty);
            $("#itemPrice").val(response.iPrice);
        } else {
            clearItemAll();
            alert("No Such a Item");
        }
    });

    function searchItem(id) {
        for (let i = 0; i < itemDB.length; i++) {
            if (itemDB[i].id == id) {
                return itemDB[i];
            }
        }
    }

    $("#deleteItem").click(function () {
        var deleteId = $("#itemId").val();
        deleteItem(deleteId);
        clearItemAll();
    });

    function deleteItem(id) {
        var index = -1;
        for (var i = 0; i < itemDB.length; i++) {
            if (itemDB[i].id == id) {
                index = i;
                alert(itemDB[i].id + " Deleted");
            }
        }

        itemDB.splice(index, 1);
    }

    $("#btnUpdate").click(function (){
        var updateItemId=$("#itemId").val();
        var updateItemName=$("#itemName").val();
        var updateItemQty=$("#itemQty").val();
        var updateItemPrice=$("#itemPrice").val();
        updateItem(updateItemId,updateItemName,updateItemQty,updateItemPrice);
        clearItemAll();
    });

    function updateItem(id,name,qty,price){
        for (let j=0;j<itemDB.length;j++){
            if (id==itemDB[j].iId){
                itemDB[j].iName=name;
                itemDB[j].iQty=qty;
                itemDB[j].iPrice=price;

                alert("Successfully Updated.");
            }
        }
    }
</script>

</body>
</html>
